<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord Administrateur - Ibn Sina</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="#" class="logo">
                <div class="logo-icon">IS</div>
                <span>Ibn Sina - Admin</span>
            </a>
            <div class="nav-menu">
                <span id="user-name" style="font-weight: 500;">Chargement...</span>
                <button class="btn btn-secondary btn-small" onclick="logout()">D√©connexion</button>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <div class="container" style="margin-top: var(--spacing-lg);">
        <!-- En-t√™te -->
        <div class="card" style="margin-bottom: var(--spacing-lg);">
            <h2 class="card-title">‚öôÔ∏è Tableau de bord Administrateur</h2>
            <p class="card-subtitle">Gestion globale de la plateforme</p>
        </div>

        <div id="admin-message" class="hidden"></div>

        <!-- Statistiques globales -->
        <div class="grid grid-3" style="margin-bottom: var(--spacing-lg);">
            <div class="card stat-card">
                <div class="stat-value" id="stat-users">0</div>
                <div class="stat-label">Utilisateurs</div>
            </div>
            <div class="card stat-card">
                <div class="stat-value" id="stat-filieres" style="color: var(--primary-color);">0</div>
                <div class="stat-label">Fili√®res</div>
            </div>
            <div class="card stat-card">
                <div class="stat-value" id="stat-requests" style="color: var(--secondary-color);">0</div>
                <div class="stat-label">Demandes totales</div>
            </div>
        </div>

        <!-- Navigation entre les vues -->
        <div style="margin-bottom: var(--spacing-md);">
            <div class="flex gap-1">
                <button class="btn btn-primary" onclick="showAdminView('filieres')">
                    üìö Gestion des fili√®res
                </button>
                <button class="btn btn-secondary" onclick="showAdminView('users')">
                    üë• Gestion des utilisateurs
                </button>
                <button class="btn btn-secondary" onclick="showAdminView('requests')">
                    üìã Toutes les demandes
                </button>
            </div>
        </div>

        <!-- Vue Gestion des fili√®res -->
        <div id="filieres-view">
            <!-- Formulaire d'ajout de fili√®re -->
            <div class="card" style="margin-bottom: var(--spacing-md);">
                <h3 style="font-weight: 600; margin-bottom: var(--spacing-md);">Ajouter une nouvelle fili√®re</h3>
                <form id="filiere-form" onsubmit="addFiliere(event)">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label" for="filiere-name">Nom de la fili√®re *</label>
                            <input type="text" id="filiere-name" class="form-input"
                                placeholder="Ex: Sciences de l'Ing√©nieur" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="filiere-delegate">D√©l√©gu√© assign√©</label>
                            <select id="filiere-delegate" class="form-select">
                                <option value="">-- Aucun d√©l√©gu√© --</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="filiere-description">Description</label>
                        <textarea id="filiere-description" class="form-textarea"
                            placeholder="Description de la fili√®re (optionnel)"></textarea>
                    </div>

                    <button type="submit" class="btn btn-success">
                        ‚ûï Cr√©er la fili√®re
                    </button>
                </form>
            </div>

            <!-- Liste des fili√®res -->
            <div>
                <h3 style="font-weight: 600; margin-bottom: var(--spacing-md);">Fili√®res existantes</h3>
                <div id="filieres-list">
                    <div class="card text-center">
                        <div class="loading" style="margin: 0 auto;"></div>
                        <p style="margin-top: var(--spacing-sm); color: var(--text-secondary);">Chargement...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vue Gestion des utilisateurs -->
        <div id="users-view" class="hidden">
            <div class="card" style="margin-bottom: var(--spacing-md);">
                <h3 style="font-weight: 600; margin-bottom: var(--spacing-xs);">Liste des utilisateurs</h3>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">G√©rez les r√¥les et permissions</p>
            </div>

            <div id="users-list">
                <div class="card text-center">
                    <p style="color: var(--text-secondary);">Chargement...</p>
                </div>
            </div>
        </div>

        <!-- Vue Toutes les demandes -->
        <div id="requests-view" class="hidden">
            <div class="card" style="margin-bottom: var(--spacing-md);">
                <h3 style="font-weight: 600; margin-bottom: var(--spacing-xs);">Vue d'ensemble des demandes</h3>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">Consultez toutes les demandes d'acc√®s</p>

                <div class="grid grid-2" style="margin-top: var(--spacing-md);">
                    <div
                        style="background: var(--bg-tertiary); padding: var(--spacing-sm); border-radius: var(--radius-sm);">
                        <strong>En attente:</strong> <span id="stat-pending"
                            style="color: var(--warning-color);">0</span>
                    </div>
                    <div
                        style="background: var(--bg-tertiary); padding: var(--spacing-sm); border-radius: var(--radius-sm);">
                        <strong>Approuv√©es:</strong> <span id="stat-approved"
                            style="color: var(--success-color);">0</span>
                    </div>
                </div>
            </div>

            <div id="requests-all-list">
                <div class="card text-center">
                    <p style="color: var(--text-secondary);">Chargement...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Scripts personnalis√©s -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>

    <script>
        // Initialiser le tableau de bord au chargement de la page
        window.addEventListener('DOMContentLoaded', async () => {
            await initAdminDashboard();

            // Peupler la liste des d√©l√©gu√©s pour le formulaire
            const delegateSelect = document.getElementById('filiere-delegate');
            const delegates = allUsers.filter(u => u.role === 'delegate');

            delegates.forEach(delegate => {
                const option = document.createElement('option');
                option.value = delegate.uid;
                option.textContent = delegate.fullName;
                delegateSelect.appendChild(option);
            });
        });
    </script>
</body>

</html>