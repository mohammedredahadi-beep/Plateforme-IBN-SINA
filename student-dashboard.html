<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord √âtudiant - Ibn Sina</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="#" class="logo">
                <div class="logo-icon">IS</div>
                <span>Ibn Sina</span>
            </a>
            <div class="nav-menu">
                <button class="theme-toggle" onclick="toggleTheme()" title="Changer le th√®me">üåì</button>
                <span id="user-name" style="font-weight: 500;">Chargement...</span>
                <button class="btn btn-secondary btn-small" onclick="logout()">D√©connexion</button>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <div class="container" style="margin-top: var(--spacing-lg);">
        <!-- Informations de l'utilisateur -->
        <div class="card" style="margin-bottom: var(--spacing-lg);">
            <div class="card-header">
                <h2 class="card-title">üëã Bienvenue !</h2>
                <p class="card-subtitle" id="user-email">Chargement...</p>
            </div>
        </div>

        <!-- Navigation par onglets [NEW] -->
        <div style="margin-bottom: var(--spacing-md);">
            <div class="flex gap-1" style="flex-wrap: wrap;">
                <button class="btn btn-primary nav-tab" onclick="showStudentView('dashboard')">üè† Tableau de
                    Bord</button>
                <button class="btn btn-secondary nav-tab" onclick="showStudentView('events')">üìÖ √âv√©nements</button>
                <button class="btn btn-secondary nav-tab" onclick="showStudentView('mentorship')">ü§ù Mentorat <span
                        class="badge"
                        style="background: var(--accent-color); font-size: 0.6em; margin-left: 5px;">NEW</span></button>
                <button class="btn btn-secondary nav-tab" onclick="showStudentView('mentorship')">ü§ù Mentorat <span
                        class="badge"
                        style="background: var(--accent-color); font-size: 0.6em; margin-left: 5px;">NEW</span></button>
                <button class="btn btn-secondary nav-tab" onclick="showStudentView('forum')">üí¨ Forum</button>
                <button class="btn btn-secondary nav-tab" onclick="showStudentView('directory')">üìÇ Annuaire</button>
            </div>
        </div>

        <div class="grid grid-2">
            <!-- Section Annonces [NEW] -->
            <div id="announcements-section" class="card hidden"
                style="grid-column: span 2; border-left: 4px solid var(--primary-color);">
                <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 10px;">üì¢ Annonces</h3>
                <div id="announcements-feed">
                    <!-- Loaded via JS -->
                </div>
            </div>
            <!-- Formulaire de demande -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìù Nouvelle demande</h3>
                    <p class="card-subtitle">Demandez l'acc√®s √† un groupe WhatsApp</p>
                </div>

                <div id="request-message" class="hidden"></div>

                <form id="request-form" onsubmit="submitRequest(event)">
                    <div class="form-group">
                        <label class="form-label" for="request-filiere">Fili√®re *</label>
                        <select id="request-filiere" class="form-select" required>
                            <option value="">Chargement...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="request-niveau">Niveau / Statut</label>
                        <select id="request-niveau" class="form-select" onchange="toggleLauratView(this.value)">
                            <option value="">-- S√©lectionnez --</option>
                            <option value="TC">Tronc Commun (TC)</option>
                            <option value="1BAC">1√®re Ann√©e Bac (1BAC)</option>
                            <option value="2BAC">2√®me Ann√©e Bac (2BAC)</option>
                            <option value="Laur√©at">Laur√©at (Dipl√¥m√©)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="request-phone">Num√©ro WhatsApp *</label>
                        <input type="tel" id="request-phone" class="form-input" placeholder="+212 6XX XXX XXX" required>
                        <small style="color: var(--text-secondary); font-size: 0.85rem;">
                            Ce num√©ro sera partag√© avec le d√©l√©gu√© pour vous ajouter au groupe
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="request-motivation">Motivation (optionnel)</label>
                        <textarea id="request-motivation" class="form-textarea"
                            placeholder="Pourquoi souhaitez-vous rejoindre ce groupe ?"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <span>Soumettre la demande</span>
                        <span class="loading hidden"></span>
                    </button>
                </form>
            </div>

            <!-- Mes demandes -->
            <div>
                <div class="card" style="margin-bottom: var(--spacing-md);">
                    <div class="card-header">
                        <h3 class="card-title">üìã Mes demandes</h3>
                        <p class="card-subtitle">Suivez l'√©tat de vos demandes</p>
                    </div>
                </div>

                <div id="requests-list">
                    <div class="card">
                        <div class="flex flex-center">
                            <div class="loading"></div>
                            <span style="margin-left: var(--spacing-sm); color: var(--text-secondary);">Chargement des
                                demandes...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vue Mentorat [NEW] -->
        <div id="mentorship-view" class="tab-content hidden">
            <div class="card"
                style="margin-bottom: var(--spacing-md); background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white;">
                <h3 class="card-title" style="color: white; margin-bottom: 5px;">ü§ù Connectez-vous avec nos Anciens</h3>
                <p style="opacity: 0.9;">B√©n√©ficiez de l'exp√©rience des laur√©ats pour guider votre avenir.</p>
            </div>

            <!-- Grid des mentors -->
            <div id="mentors-grid" class="grid grid-3" style="gap: 20px;">
                <!-- Inject√© par JS -->
            </div>
        </div>
    </div>

    <!-- Vue Forum [NEW] -->
    <div id="forum-view" class="tab-content hidden">
        <div class="card" style="margin-bottom: var(--spacing-md); background: white;">
            <div class="flex" style="justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <h2 style="font-size: 1.5rem; font-weight: 700;">Forum de discussion</h2>
                    <p style="color: var(--text-secondary);">Posez vos questions et √©changez avec la communaut√©.</p>
                </div>
                <button class="btn btn-primary" onclick="openNewPostModal()">
                    <span>+ Nouveau Post</span>
                </button>
            </div>

            <!-- Filters -->
            <div class="flex gap-1" style="margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px;">
                <button class="btn btn-secondary btn-small filter-btn active" data-category="all"
                    onclick="loadForumPosts('all')">Tout</button>
                <button class="btn btn-secondary btn-small filter-btn" data-category="Orientation"
                    onclick="loadForumPosts('Orientation')">Orientation</button>
                <button class="btn btn-secondary btn-small filter-btn" data-category="Stage"
                    onclick="loadForumPosts('Stage')">Stage & Emploi</button>
                <button class="btn btn-secondary btn-small filter-btn" data-category="Campus"
                    onclick="loadForumPosts('Campus')">Vie du Campus</button>
            </div>

            <!-- Feed -->
            <div id="forum-feed" class="flex flex-col" style="gap: 15px;">
                <!-- Inject√© par JS -->
            </div>
        </div>
    </div>

    <!-- Vue √âv√©nements [NEW] -->
    <div id="events-view" class="tab-content hidden">
        <div class="card" style="margin-bottom: var(--spacing-md);">
            <div class="flex" style="justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="font-weight: 600;">üìÖ √âv√©nements & Actualit√©s</h3>
                    <p style="color: var(--text-secondary);">Ne manquez rien de la vie √©tudiante</p>
                </div>
            </div>
        </div>

        <div id="events-feed" class="grid grid-3" style="gap: 15px;">
            <!-- Loaded by JS -->
        </div>
    </div>




    <!-- Espace Laur√©at (Section Alumni Premium) -->
    <div id="laureat-view" class="hidden">
        <div class="card fade-in"
            style="background: var(--glass-bg); border: 2px solid var(--primary-color); position: relative; overflow: hidden; margin-bottom: var(--spacing-lg);">
            <div
                style="position: absolute; top: -10px; right: -10px; font-size: 5rem; opacity: 0.05; transform: rotate(15deg);">
                üéì</div>
            <div class="card-header">
                <h2 class="card-title"
                    style="color: var(--primary-color); display: flex; align-items: center; gap: 10px;">
                    <span>üíé Espace Laur√©at Ibn Sina</span>
                </h2>
                <p class="card-subtitle">Bienvenue dans votre espace exclusif, cher ancien.</p>
            </div>

            <div class="grid grid-3" style="margin-top: var(--spacing-md); gap: 15px;">
                <div class="card"
                    style="padding: 15px; background: rgba(var(--primary-rgb), 0.03); border: 1px solid var(--border-color); cursor: pointer; transition: 0.3s;"
                    onclick="joinMentorship()">
                    <div style="font-size: 1.5rem; margin-bottom: 10px;">ü§ù</div>
                    <h4 style="font-weight: 600; font-size: 0.95rem;">Devenir Mentor</h4>
                    <p style="font-size: 0.75rem; color: var(--text-secondary);">Accompagnez les nouveaux √©tudiants.
                    </p>
                </div>
                <div class="card"
                    style="padding: 15px; background: rgba(var(--secondary-rgb), 0.03); border: 1px solid var(--border-color); cursor: pointer; transition: 0.3s;"
                    onclick="shareResources()">
                    <div style="font-size: 1.5rem; margin-bottom: 10px;">üìö</div>
                    <h4 style="font-weight: 600; font-size: 0.95rem;">Ressources</h4>
                    <p style="font-size: 0.75rem; color: var(--text-secondary);">Partagez vos outils & conseils.</p>
                </div>
                <div class="card"
                    style="padding: 15px; background: rgba(245, 158, 11, 0.03); border: 1px solid var(--border-color); cursor: pointer; transition: 0.3s;"
                    onclick="window.open('https://linkedin.com', '_blank')">
                    <div style="font-size: 1.5rem; margin-bottom: 10px;">ÔøΩ</div>
                    <h4 style="font-weight: 600; font-size: 0.95rem;">Opportunit√©s</h4>
                    <p style="font-size: 0.75rem; color: var(--text-secondary);">Publiez ou trouvez une offre.</p>
                </div>
            </div>

            <hr
                style="margin: var(--spacing-lg) 0; border: 0; border-top: 1px solid var(--border-color); opacity: 0.3;">

            <!-- R√©seau de ma Promotion -->
            <div id="promo-network-section">
                <h3
                    style="font-size: 1.1rem; font-weight: 600; margin-bottom: var(--spacing-md); display: flex; align-items: center; gap: 8px;">
                    <span>üë• R√©seau de ma Promotion</span>
                    <span id="my-promo-badge" class="badge badge-approved" style="font-size: 0.7rem;"></span>
                </h3>
                <div id="promo-users-list" class="grid grid-3" style="gap: 15px;">
                    <div class="card text-center" style="grid-column: span 3;">
                        <p style="color: var(--text-secondary);">Chargement des contacts...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Aide -->
    <div class="card" style="margin-top: var(--spacing-lg);">
        <h4 style="font-weight: 600; margin-bottom: var(--spacing-sm);">‚ÑπÔ∏è Comment √ßa marche ?</h4>
        <ol style="padding-left: var(--spacing-lg); color: var(--text-secondary);">
            <li style="margin-bottom: var(--spacing-xs);">Remplissez le formulaire avec la fili√®re qui vous
                int√©resse</li>
            <li style="margin-bottom: var(--spacing-xs);">Votre demande sera automatiquement transmise au d√©l√©gu√© de
                cette fili√®re</li>
            <li style="margin-bottom: var(--spacing-xs);">Le d√©l√©gu√© examinera et approuvera/rejettera votre demande
            </li>
            <li>Si approuv√©e, vous recevrez le lien du groupe WhatsApp ou serez ajout√© directement</li>
        </ol>
    </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Scripts personnalis√©s -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/chatbot-ui.js"></script>
    <script src="js/student.js"></script>
    <script src="js/mentorship.js"></script>
    <script src="js/forum.js"></script>
    <script src="js/announcements.js"></script>
    <script src="js/directory.js"></script>
    <script src="js/events.js"></script>

    <script>
        // Initialiser le tableau de bord au chargement de la page
        window.addEventListener('DOMContentLoaded', () => {
            initStudentDashboard();
            if (typeof initAnnouncementsValue === 'function') initAnnouncementsValue();
        });

        // Fonction pour g√©rer les onglets √©tudiants (Similaire √† celle des autres dashboards)
        function showStudentView(view) {
            // Masquer toutes les vues
            // Note: student.js ne g√®re pas nativement les onglets comme alumni.js, 
            // il affichait tout sur une page. On va adapter √ßa.

            // Masquer les sections par d√©faut
            const dashboardSection = document.querySelector('.grid.grid-2'); // Contient le form et la liste
            const laheuatSection = document.getElementById('laureat-view');
            const mentorshipSection = document.getElementById('mentorship-view');
            const forumSection = document.getElementById('forum-view');
            const directorySection = document.getElementById('directory-view');

            // Reset tabs
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');

                const btnText = btn.innerHTML.toLowerCase(); // Utiliser innerHTML pour attraper le texte et les icones

                if (view === 'requests' && btnText.includes('demandes')) {
                    btn.classList.remove('btn-secondary'); btn.classList.add('btn-primary');
                } else if (view === 'mentorship' && btnText.includes('mentorat')) {
                    btn.classList.remove('btn-secondary'); btn.classList.add('btn-primary');
                } else if (view === 'dashboard' && btnText.includes('tableau')) {
                    btn.classList.remove('btn-secondary'); btn.classList.add('btn-primary');
                } else if (view === 'forum' && btnText.includes('forum')) {
                    btn.classList.remove('btn-secondary'); btn.classList.add('btn-primary');
                } else if (view === 'directory' && btnText.includes('annuaire')) {
                    btn.classList.remove('btn-secondary'); btn.classList.add('btn-primary');
                } else if (view === 'events' && btnText.includes('√©v√©nements')) {
                    btn.classList.remove('btn-secondary'); btn.classList.add('btn-primary');
                }
            });

            if (view === 'dashboard') {
                if (dashboardSection) dashboardSection.classList.remove('hidden');
                if (laheuatSection && currentUser && currentUser.niveau === 'Laur√©at') laheuatSection.classList.remove('hidden');
                if (mentorshipSection) mentorshipSection.classList.add('hidden');
                if (forumSection) forumSection.classList.add('hidden');
                if (directorySection) directorySection.classList.add('hidden');
                const eventsSection = document.getElementById('events-view');
                if (eventsSection) eventsSection.classList.add('hidden');
            } else if (view === 'events') {
                if (dashboardSection) dashboardSection.classList.add('hidden');
                if (laheuatSection) laheuatSection.classList.add('hidden');
                if (mentorshipSection) mentorshipSection.classList.add('hidden');
                if (forumSection) forumSection.classList.add('hidden');
                if (directorySection) directorySection.classList.add('hidden');
                const eventsSection = document.getElementById('events-view');
                if (eventsSection) eventsSection.classList.remove('hidden');

                if (typeof loadEvents === 'function') loadEvents('events-feed');
            } else if (view === 'requests') {
                // Pour simplifier, 'requests' et 'dashboard' sont la m√™me vue dans l'impl√©mentation actuelle
                if (dashboardSection) dashboardSection.classList.remove('hidden');
                if (laheuatSection) laheuatSection.classList.add('hidden');
                if (mentorshipSection) mentorshipSection.classList.add('hidden');
                if (forumSection) forumSection.classList.add('hidden');
            } else if (view === 'mentorship') {
                if (dashboardSection) dashboardSection.classList.add('hidden');
                if (laheuatSection) laheuatSection.classList.add('hidden');
                if (mentorshipSection) mentorshipSection.classList.remove('hidden');
                if (forumSection) forumSection.classList.add('hidden');

                // Charger les mentors si pas encore fait
                if (typeof initMentorship === 'function') {
                    initMentorship();
                }
            } else if (view === 'forum') {
                if (dashboardSection) dashboardSection.classList.add('hidden');
                if (laheuatSection) laheuatSection.classList.add('hidden');
                if (mentorshipSection) mentorshipSection.classList.add('hidden');
                if (forumSection) forumSection.classList.remove('hidden');
                if (directorySection) directorySection.classList.add('hidden');

                if (typeof initForum === 'function') {
                    initForum();
                }
                if (typeof initForum === 'function') {
                    initForum();
                }
            } else if (view === 'directory') {
                if (dashboardSection) dashboardSection.classList.add('hidden');
                if (laheuatSection) laheuatSection.classList.add('hidden');
                if (mentorshipSection) mentorshipSection.classList.add('hidden');
                if (forumSection) forumSection.classList.add('hidden');
                const directorySection = document.getElementById('directory-view');
                if (directorySection) directorySection.classList.remove('hidden');

                if (typeof initDirectory === 'function') initDirectory();
            }
        }
    </script>



</body>

</html>